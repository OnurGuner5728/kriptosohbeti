<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kripto Borsalar - Detaylı Borsa Verileri</title>
    <link rel="stylesheet" href="style1.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        :root {
            --bg-main: #111;
            --bg-card: #181818;
            --text-main: #fff;
            --text-secondary: #bfc2a7;
            --border-main: #222;
            --highlight: #ffb300;
            --btn-bg: #181818;
            --btn-border: #333;
            --btn-hover: #222;
            --footer-bg: #181818;
            --footer-text: #fff;
        }
        body.light-theme {
            --bg-main: #f7f7fa;
            --bg-card: #fff;
            --text-main: #000000;
            --text-secondary: #666;
            --border-main: #e0e0e0;
            --highlight: #ffb300;
            --btn-bg: #fff;
            --btn-border: #e0e0e0;
            --btn-hover: #f5f5f5;
            --footer-bg: #f5f5f5;
            --footer-text: #222;
        }
        body {
            background: var(--bg-main);
            color: var(--text-main);
            transition: background 0.3s, color 0.3s;
        }
        .main-header, .site-footer, .footer-container, .footer-section {
            background: var(--footer-bg) !important;
            color: var(--footer-text) !important;
        }
        .main-header nav ul li a {
            color: var(--text-main);
            transition: color 0.2s;
        }
        .main-header nav ul li a:hover {
            color: var(--highlight);
        }
        .main-header {
            background-color: #1a1a1a;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            flex-wrap: wrap; /* Küçük ekranlarda alt alta geçiş için */
        }

        .main-header .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: bold;
            color: #ffb300; /* Logo rengi */
        }

        .main-header .logo-img {
            width: 40px;
            height: 40px;
        }

        .main-header nav ul {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
            gap: 25px;
            flex-wrap: wrap; /* Küçük ekranlarda menü öğeleri sarılması için */
            justify-content: center; /* Ortalamak için */
        }

        .main-header nav a {
            color: #e0e0e0;
            text-decoration: none;
            padding: 8px 0;
            transition: color 0.3s ease;
            position: relative;
        }

        .main-header nav a.active {
            color: #ffb300;
            font-weight: bold;
        }

        .main-header nav a:hover {
            color: #ffb300;
        }

        .main-header .header-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .main-header .header-actions button {
            background-color: #333;
            color: #e0e0e0;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .main-header .header-actions button:hover {
            background-color: #555;
        }

        .lang-dropdown {
            position: relative;
            display: inline-block;
        }
        .lang-btn {
            background: #b71c1c;
            border: none;
            border-radius: 50%;
            width: 38px;
            height: 38px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            transition: box-shadow 0.2s;
        }
        .lang-btn:focus {
            outline: none;
            box-shadow: 0 0 0 2px #ffb300;
        }
        .lang-menu {
            display: none;
            position: absolute;
            right: 0;
            top: 44px;
            background: #181818;
            border-radius: 12px;
            box-shadow: 0 4px 16px #0008;
            min-width: 140px;
            z-index: 9999;
            padding: 8px 0;
        }
        .lang-dropdown.open .lang-menu {
            display: block;
        }
        .lang-option {
            padding: 10px 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #fff;
            font-size: 1.08em;
            transition: background 0.15s;
        }
        .lang-option:hover {
            background: #222;
        }
        .flag-icon {
            font-size: 1.2em;
        }
    </style>
</head>
<body>
<header class="main-header">
    <div class="logo">
        <img src="favicon.png" alt="Logo" class="logo-img">
        <span>Kripto Sohbeti</span>
    </div>
    <nav>
        <ul>
            <li><a href="index.html" data-i18n="menuHome">Ana Sayfa</a></li>
            <li><a href="haberler.html" id="haberler-link" data-i18n="menuNews">Haberler</a></li>
            <li><a href="kp.html" data-i18n="menuMarkets">Kripto Paralar</a></li>
            <li><a href="borsa.html" data-i18n="menuExchanges">Borsalar</a></li>
            <li><a href="#" data-i18n="menuCalendar">Takvim</a></li>
        </ul>
    </nav>
    <div class="header-actions">
        <div class="lang-dropdown" id="lang-dropdown">
            <button class="lang-btn" id="lang-btn">
                <span class="flag-icon" id="selected-flag">🇹🇷</span>
            </button>
            <div class="lang-menu" id="lang-menu">
                <div class="lang-option" data-lang="en"><span class="flag-icon">🇺🇸</span> English</div>
                <div class="lang-option" data-lang="tr"><span class="flag-icon">🇹🇷</span> Türkçe</div>
            </div>
        </div>
        <button id="btn-theme" title="Tema Değiştir">🌙</button>
    </div>
</header>

<div class="exchange-page-container">
  <div class="exchange-header-section">
      <div class="left-content">
          <h2 data-i18n="exchanges">Borsalar</h2>
          <p data-i18n="exchangesDesc">Borsalar, kripto para birimlerinin işlem gördüğü platformlardır. Bu platformlarda, ticaret için bir yer sağlar.</p>
      </div>
  </div>
  <!-- Google AdSense (örnek kod, kendi kodunla değiştir) -->
  <div style="margin: 24px auto; max-width: 900px;">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle"
         style="display:block; text-align:center;"
         data-ad-client="ca-pub-XXXXXXXXXXXXXXX"
         data-ad-slot="1234567890"
         data-ad-format="auto"
         data-full-width-responsive="true"></ins>
    <script>
         (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </div>
  <div class="exchange-table-section">
      <h3 data-i18n="exchangesTable">Kripto Borsalar Tablosu</h3>
      <div class="exchange-table-wrapper">
          <table>
              <thead>
                  <tr>
                      <th>#</th>
                      <th data-i18n="exchanges">Borsa</th>
                      <th data-i18n="trust">Güven</th>
                      <th data-i18n="volume24h">24s Hacim</th>
                      <th data-i18n="normalVolume">Normal Hacim</th>
                  </tr>
              </thead>
              <tbody id="exchange-table-body">
                  <tr><td colspan="7" style="text-align: center; padding: 20px;" data-i18n="loading">Borsa verileri yükleniyor...</td></tr>
              </tbody>
          </table>
      </div>
  </div>
</div>

<style>
    body {
  background-color: #000; /* Tam siyah */
  color: #e0e0e0; /* Açık renk yazı */
  margin: 0;
  padding: 0;
  font-family: Arial, sans-serif;
}

  /* borsa.html'e özgü CSS kuralları */
  .exchange-page-container {
      padding: 20px;
      max-width: 1200px;
      margin: 20px auto;
      background: #1e1e1e;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      color: #e0e0e0;
  }

  .exchange-header-section {
      display: flex;
      justify-content: space-between;
      align-items: flex-start; /* Üstten hizala */
      margin-bottom: 30px;
      flex-wrap: wrap; /* Mobil uyumluluk için */
      gap: 20px;
  }

  .exchange-header-section .left-content h2 {
      font-size: 2rem;
      color: #ffb300;
      margin-bottom: 10px;
  }

  .exchange-header-section .left-content p {
      font-size: 0.95rem;
      color: #aaa;
      max-width: 600px;
      line-height: 1.5;
  }

  .exchange-header-section .right-content {
      display: flex;
      align-items: center;
  }

  .search-and-filter {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
  }

  .exchange-search-input {
      background: #2a2a2a;
      border: 1px solid #3a3a3a;
      border-radius: 8px;
      padding: 10px 15px;
      color: #e0e0e0;
      font-size: 0.9rem;
      width: 200px; /* Sabit genişlik */
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
  }

  .exchange-search-input::placeholder {
      color: #888;
  }

  .exchange-search-input:focus {
      border-color: #ffb300;
      box-shadow: 0 0 0 3px rgba(255, 179, 0, 0.2);
      outline: none;
  }

  .exchange-filter-select {
      background: #2a2a2a;
      border: 1px solid #3a3a3a;
      border-radius: 8px;
      padding: 10px 15px;
      color: #e0e0e0;
      font-size: 0.9rem;
      cursor: pointer;
      -webkit-appearance: none; /* Varsayılan select stilini kaldır */
      -moz-appearance: none;
      appearance: none;
      background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23e0e0e0%22%20d%3D%22M287%2C197.6c-3.2%2C3.2-8.3%2C3.2-11.5%2C0L146.2%2C74.8L16.9%2C197.6c-3.2%2C3.2-8.3%2C3.2-11.5%2C0L0%2C186.1l146.2-146.2l146.2%2C146.2L287%2C197.6z%22%2F%3E%3C%2Fsvg%3E'); /* Özel ok ikonu */
      background-repeat: no-repeat;
      background-position: right 10px top 50%;
      background-size: 12px auto;
      padding-right: 30px; /* Ok için boşluk */
  }

  .exchange-filter-select:focus {
      border-color: #ffb300;
      box-shadow: 0 0 0 3px rgba(255, 179, 0, 0.2);
      outline: none;
  }

  .exchange-table-section {
      margin-top: 30px;
  }

  .exchange-table-section h3 {
      font-size: 1.5rem;
      color: #fff;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid #2a2a2a;
  }

  .exchange-table-wrapper {
      width: 100%;
      overflow-x: auto; /* Yatay kaydırma için */
  }

  .exchange-table-wrapper table {
      width: 100%;
      border-collapse: collapse;
      color: #e0e0e0;
      min-width: 800px; /* Tablonun daralmasını engelle */
  }

  .exchange-table-wrapper th,
  .exchange-table-wrapper td {
      padding: 14px 16px;
      text-align: left;
      border-bottom: 1px solid #2a2a2a;
      white-space: nowrap;
  }

  .exchange-table-wrapper th {
      background: #0d0d0d;
      font-weight: 600;
      color: #aaa;
      text-transform: uppercase;
      font-size: 0.8rem;
  }

  .exchange-table-wrapper tr:hover {
      background: #2a2a2a;
  }

  .exchange-table-wrapper td img {
      vertical-align: middle;
      margin-right: 10px;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      object-fit: contain;
  }

  .exchange-table-wrapper td .trust-score {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      color: #00c853; /* Yeşil */
  }

  .exchange-table-wrapper td .trust-score.low {
      color: #ff3d00; /* Kırmızı */
  }

  .exchange-table-wrapper td .trust-score .fa-star {
      font-size: 0.9rem;
  }

  /* Sparkline için SVG */
  .exchange-table-wrapper td svg {
      overflow: visible; /* Çizginin taşmasına izin ver */
  }

  /* Mobil uyumluluk */
  @media (max-width: 768px) {
      .exchange-header-section {
          flex-direction: column;
          align-items: center;
          text-align: center;
          padding: 15px;
      }

      .exchange-header-section .left-content,
      .exchange-header-section .right-content {
          width: 100%;
          justify-content: center;
      }

      .exchange-search-input, 
      .exchange-filter-select {
          width: 100%;
          margin-bottom: 10px;
      }

      .search-and-filter {
          flex-direction: column;
          width: 100%;
      }

      .exchange-table-wrapper {
          margin: 0 -15px;
          width: calc(100% + 30px);
      }

      .exchange-table-wrapper table {
          min-width: 600px;
      }

      .main-header {
          padding: 10px 15px;
      }

      .main-header nav ul {
          gap: 15px;
      }

      .main-header .logo {
          font-size: 1.2rem;
      }

      .main-header .logo-img {
          width: 30px;
          height: 30px;
      }
  }

  @media (max-width: 500px) {
      .exchange-header-section .left-content h2 {
          font-size: 1.6rem;
      }

      .exchange-header-section .left-content p {
          font-size: 0.9rem;
      }

      .exchange-table-section h3 {
          font-size: 1.3rem;
          padding: 0 15px;
      }

      .exchange-table-wrapper th,
      .exchange-table-wrapper td {
          padding: 10px;
          font-size: 0.9rem;
      }

      .exchange-table-wrapper td img {
          width: 24px;
          height: 24px;
      }

      .main-header nav ul {
          gap: 10px;
          font-size: 0.9rem;
      }

      .main-header .header-actions button {
          padding: 6px 12px;
          font-size: 0.9rem;
      }

      #exchange-modal {
          padding: 15px;
      }

      #exchange-modal > div {
          width: 95%;
          padding: 20px 15px;
      }
  }

</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
      const exchangeTableBody = document.getElementById('exchange-table-body');
      const exchangeSearchInput = document.querySelector('.exchange-search-input');
      const exchangeFilterSelect = document.querySelector('.exchange-filter-select');
      let allExchangesData = []; // Tüm borsaları saklayacak

      async function fetchExchangeData() {
          if (!exchangeTableBody) return;

          exchangeTableBody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px; color: #aaa;">Borsa verileri yükleniyor...</td></tr>';

          try {
              // Bitcoin fiyatını al
              const btcResponse = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd');
              const btcData = await btcResponse.json();
              const btcPrice = btcData.bitcoin.usd;

              // İlk 45 borsayı çek
              const response = await fetch('https://api.coingecko.com/api/v3/exchanges?per_page=45&page=1');
              if (!response.ok) {
                  throw new Error(`API hatası! Status: ${response.status}`);
              }
              const data = await response.json();
              allExchangesData = data;

              // Her borsa için detaylı veri çek
              const detailedData = await Promise.all(
                  data.map(async (exchange) => {
                      try {
                          const detailResponse = await fetch(`https://api.coingecko.com/api/v3/exchanges/${exchange.id}`);
                          if (detailResponse.ok) {
                              const detailData = await detailResponse.json();
                              return {
                                  ...exchange,
                                  tickers: detailData.tickers || [],
                                  trust_score_rank: detailData.trust_score_rank || 0,
                                  trade_volume_24h_btc: detailData.trade_volume_24h_btc || 0,
                                  trade_volume_24h_usd: (detailData.trade_volume_24h_btc || 0) * btcPrice
                              };
                          }
                      } catch (error) {
                          console.error(`${exchange.name} için detay verisi alınamadı:`, error);
                      }
                      return exchange;
                  })
              );

              renderExchangeTable(detailedData);
          } catch (error) {
              console.error('Borsa verisi çekilirken hata:', error);
              exchangeTableBody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px; color: #ff3d00;">Borsa verileri yüklenemedi. Lütfen tekrar deneyin.</td></tr>';
          }
      }

      function renderExchangeTable(dataToRender) {
          exchangeTableBody.innerHTML = '';

          if (dataToRender.length === 0) {
              exchangeTableBody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px; color: #aaa;">Gösterilecek borsa bulunamadı.</td></tr>';
              return;
          }

          dataToRender.forEach((exchange, index) => {
              const row = document.createElement('tr');

              // Güven puanı gösterimi
              let trustScoreHtml = '';
              if (exchange.trust_score !== undefined && exchange.trust_score !== null) {
                  const score = exchange.trust_score;
                  let starColorClass = score >= 8 ? 'trust-score' : 'trust-score low';
                  trustScoreHtml = `<span class="${starColorClass}">${score}/10 <i class="fas fa-star"></i></span>`;
              } else {
                  trustScoreHtml = '-';
              }

              // Hacim normalizasyonu ve USD dönüşümü
              const volume24hUsd = exchange.trade_volume_24h_usd ? 
                  exchange.trade_volume_24h_usd.toLocaleString(undefined, {
                      style: 'currency', 
                      currency: 'USD', 
                      maximumFractionDigits: 0
                  }) : '$0';

              // Ziyaretçi sayısı - Hacim ve güven puanına göre hesapla
              const baseVisits = exchange.trade_volume_24h_usd ? 
                  Math.log10(exchange.trade_volume_24h_usd) * 100000 : 0;
              const trustMultiplier = exchange.trust_score ? exchange.trust_score / 10 : 1;
              const estimatedVisits = Math.round(baseVisits * trustMultiplier);
              const formattedVisits = formatNumber(estimatedVisits);

              // Grafik için ticker verilerini kullan
              let sparklinePoints = '';
              if (exchange.tickers && exchange.tickers.length > 0) {
                  // Son 24 saatteki fiyat değişimlerini al
                  const prices = exchange.tickers
                      .slice(0, 10)
                      .map(ticker => {
                          const price = ticker.converted_last?.usd || 0;
                          const change = ticker.converted_volume?.usd || 0;
                          return { price, change };
                      })
                      .filter(data => data.price > 0 && data.change > 0)
                      .sort((a, b) => b.change - a.change)
                      .map(data => data.price);

                  if (prices.length > 0) {
                      const maxPrice = Math.max(...prices);
                      const minPrice = Math.min(...prices);
                      const range = maxPrice - minPrice || 1;
                      
                      sparklinePoints = prices.map((price, i) => {
                          const x = (i * 10);
                          const y = 30 - ((price - minPrice) / range * 25);
                          return `${x},${y}`;
                      }).join(' ');
                  }
              }

              // Eğer grafik verisi yoksa hacim verilerine göre oluştur
              if (!sparklinePoints) {
                  const volume = exchange.trade_volume_24h_usd || 0;
                  const points = [];
                  for (let i = 0; i <= 100; i += 10) {
                      const randomFactor = 0.8 + Math.random() * 0.4; // 0.8 ile 1.2 arası
                      const y = 30 - (Math.log10(volume * randomFactor) * 2);
                      points.push(`${i},${y}`);
                  }
                  sparklinePoints = points.join(' ');
              }

              const sparklineColor = index % 2 === 0 ? '#00c853' : '#ff3d00';

              row.innerHTML = `
                  <td>${index + 1}</td>
                  <td>
                      <img src="${exchange.image || 'https://via.placeholder.com/30'}" alt="${exchange.name} Logo">
                      ${exchange.name}
                  </td>
                  <td>${trustScoreHtml}</td>
                  <td>${volume24hUsd}</td>
                  <td>$${(exchange.trade_volume_24h_usd || 0).toLocaleString(undefined, {maximumFractionDigits: 0})}</td>
                  <td>${formattedVisits}</td>
                  <td>
                      <svg width="100" height="30" viewBox="0 0 100 30">
                          <polyline
                              points="${sparklinePoints}"
                              fill="none"
                              stroke="${sparklineColor}"
                              stroke-width="2"
                          />
                      </svg>
                  </td>
              `;
              exchangeTableBody.appendChild(row);
          });
      }

      // Sayı formatlama yardımcı fonksiyonu
      function formatNumber(num) {
          if (num >= 1000000) {
              return (num / 1000000).toFixed(1) + 'M';
          } else if (num >= 1000) {
              return (num / 1000).toFixed(1) + 'K';
          }
          return num.toString();
      }

      // Arama ve filtreleme fonksiyonu
      function filterAndSearchExchanges() {
          const searchTerm = exchangeSearchInput.value.toLowerCase();
          const filterType = exchangeFilterSelect.value; // 'kripto' veya 'olmayan' (şimdilik sadece 'kripto' desteklenecek)

          let filteredData = allExchangesData.filter(exchange => {
              const matchesSearch = exchange.name.toLowerCase().includes(searchTerm);
              // CoinGecko API'sinde "kripto olmayan borsa" gibi bir kategori doğrudan yok.
              // Bu filtre için ek bir veri veya mantık gerekecektir.
              // Şimdilik sadece 'kripto' seçili olsa bile tüm borsaları gösterelim veya bu filtreyi kaldırabiliriz.
              return matchesSearch;
          });
          renderExchangeTable(filteredData);
      }

      // Basit bir arama ve filtreleme etkinliği
      exchangeSearchInput.addEventListener('input', filterAndSearchExchanges);
      // exchangeFilterSelect.addEventListener('change', filterAndSearchExchanges); // Bu şimdilik aktif değil, çünkü API desteklemiyor

      // ----- Simülasyon Fonksiyonları (API'den gelmeyen veriler için) -----

      // Rastgele ziyaretçi sayısı üretme
      function getRandomVisits() {
          return Math.floor(Math.random() * (50000000 - 1000000 + 1)) + 1000000; // 1M - 50M arası
      }

      // Basit bir sparkline grafiği için rastgele noktalar üretme
      function generateRandomSparklinePoints() {
          const points = [];
          for (let i = 0; i <= 100; i += 10) { // 10'ar birim arayla 11 nokta
              const y = Math.random() * 20 + 5; // 5 ile 25 arası değer
              points.push(`${i},${y}`);
          }
          return points.join(' ');
      }


      // Borsaları ilk yüklendiğinde ve belirli aralıklarla çek
      fetchExchangeData();
      setInterval(fetchExchangeData, 300000); // Her 5 dakikada bir güncelle (300000 ms)

      // Çeviri sistemi
      const translations = {
          tr: {
              menuHome: "Ana Sayfa",
              menuNews: "Haberler",
              menuMarkets: "Kripto Paralar",
              menuExchanges: "Borsalar",
              menuData: "Veri",
              menuCalendar: "Takvim",
              menuPortfolio: "Portföy",
              exchanges: "Borsalar",
              exchangesDesc: "Borsalar, kripto para birimlerinin işlem gördüğü platformlardır. Bu platformlarda, ticaret için bir yer sağlar.",
              exchangesTable: "Kripto Borsalar Tablosu",
              loading: "Borsa verileri yükleniyor...",
              noData: "Borsa verileri yüklenemedi. Lütfen tekrar deneyin.",
              noExchanges: "Gösterilecek borsa bulunamadı.",
              trust: "Güven",
              volume24h: "24s Hacim",
              normalVolume: "Normal Hacim",
              visits: "Ziyaret",
              chart: "Grafik",
              country: "Ülke",
              year: "Yıl",
              score: "Skor",
              web: "Web",
              details: "Detaylar alınamadı."
          },
          en: {
              menuHome: "Home",
              menuNews: "News",
              menuMarkets: "Markets",
              menuExchanges: "Exchanges",
              menuData: "Data",
              menuCalendar: "Calendar",
              menuPortfolio: "Portfolio",
              exchanges: "Exchanges",
              exchangesDesc: "Exchanges are platforms where cryptocurrencies are traded. These platforms provide a place for trading.",
              exchangesTable: "Crypto Exchanges Table",
              loading: "Exchange data loading...",
              noData: "Exchange data could not be loaded. Please try again.",
              noExchanges: "No exchanges found to display.",
              trust: "Trust",
              volume24h: "24h Volume",
              normalVolume: "Normal Volume",
              visits: "Visits",
              chart: "Chart",
              country: "Country",
              year: "Year",
              score: "Score",
              web: "Web",
              details: "Details could not be loaded."
          }
      };

      let currentLang = 'tr';

      function updateLanguage(lang) {
          currentLang = lang;
          document.querySelectorAll('[data-i18n]').forEach(element => {
              const key = element.getAttribute('data-i18n');
              if (translations[lang][key]) {
                  element.textContent = translations[lang][key];
              }
          });
      }

      // Dil dropdown menüsü (yeni sistem)
      const langDropdown = document.getElementById('lang-dropdown');
      const langBtn = document.getElementById('lang-btn');
      const langMenu = document.getElementById('lang-menu');
      const selectedFlag = document.getElementById('selected-flag');

      function setLangUI(lang) {
          selectedFlag.textContent = lang === 'en' ? '🇺🇸' : '🇹🇷';
      }
      setLangUI('tr');

      langBtn.addEventListener('click', function(e) {
          e.stopPropagation();
          langDropdown.classList.toggle('open');
      });

      langMenu.querySelectorAll('.lang-option').forEach(function(opt) {
          opt.addEventListener('click', function() {
              const lang = this.getAttribute('data-lang');
              updateLanguage(lang);
              setLangUI(lang);
              langDropdown.classList.remove('open');
          });
      });

      document.addEventListener('click', function() {
          langDropdown.classList.remove('open');
      });
  });
</script>

<!-- Modal -->
<div id="exchange-modal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.6);z-index:9999;align-items:center;justify-content:center;">
  <div style="background:#222;padding:32px 24px;border-radius:12px;max-width:400px;width:90%;color:#fff;position:relative;">
    <button onclick="document.getElementById('exchange-modal').style.display='none'" style="position:absolute;top:8px;right:12px;font-size:1.5em;background:none;border:none;color:#fff;cursor:pointer;">&times;</button>
    <div id="exchange-modal-content">Yükleniyor...</div>
  </div>
</div>

<script>
async function fetchExchanges() {
  const tbody = document.getElementById('exchange-table-body');
  tbody.innerHTML = '<tr><td colspan="5">Yükleniyor...</td></tr>';
  try {
    const res = await fetch('https://api.coingecko.com/api/v3/exchanges?per_page=45&page=1');
    const data = await res.json();
    tbody.innerHTML = '';
    data.forEach((ex, i) => {
      const tr = document.createElement('tr');
      tr.style.cursor = 'pointer';
      tr.innerHTML = `
        <td>${i+1}</td>
        <td><img src="${ex.image}" alt="" style="width:22px;vertical-align:middle;margin-right:8px;border-radius:50%;">${ex.name}</td>
        <td>${ex.trust_score ?? '-'}</td>
        <td>${ex.trade_volume_24h_btc ? Number(ex.trade_volume_24h_btc).toLocaleString() + ' BTC' : '-'}</td>
        <td>${ex.country || '-'}</td>
      `;
      tr.onclick = () => showExchangeDetail(ex.id);
      tbody.appendChild(tr);
    });
  } catch {
    tbody.innerHTML = '<tr><td colspan="5">Veriler alınamadı.</td></tr>';
  }
}

async function showExchangeDetail(id) {
  const modal = document.getElementById('exchange-modal');
  const content = document.getElementById('exchange-modal-content');
  modal.style.display = 'flex';
  content.innerHTML = 'Yükleniyor...';
  try {
    const res = await fetch(`https://api.coingecko.com/api/v3/exchanges/${id}`);
    const ex = await res.json();
    content.innerHTML = `
      <h2 style="margin-bottom:8px;">${ex.name}</h2>
      <img src="${ex.image}" alt="" style="width:48px;border-radius:8px;margin-bottom:8px;">
      <div><b>Ülke:</b> ${ex.country || '-'}</div>
      <div><b>Yıl:</b> ${ex.year_established || '-'}</div>
      <div><b>24s Hacim:</b> ${ex.trade_volume_24h_btc ? Number(ex.trade_volume_24h_btc).toLocaleString() + ' BTC' : '-'}</div>
      <div><b>Skor:</b> ${ex.trust_score ?? '-'}</div>
      <div><b>Web:</b> <a href="${ex.url}" target="_blank" style="color:#f0b90b">${ex.url}</a></div>
      <div style="margin-top:8px;font-size:0.95em;color:#aaa;">${ex.description || ''}</div>
    `;
  } catch {
    content.innerHTML = 'Detaylar alınamadı.';
  }
}
fetchExchanges();
</script>

<script>
    // Tema değiştirme fonksiyonu
    document.getElementById('btn-theme').addEventListener('click', function() {
        document.body.classList.toggle('light-theme');
        const themeBtn = document.getElementById('btn-theme');
        themeBtn.textContent = document.body.classList.contains('light-theme') ? '☀️' : '🌙';
    });
</script>
</body>
</html>